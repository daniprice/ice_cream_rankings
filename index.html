<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nathan & Dani's Ice Cream Rankings</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>üç¶ Nathan & Dani's Ice Cream Rankings üç¶</h1>
        <p>We take this very seriously. Our rankings are based on our professional, objective opinions.</p>
        <p class="subtitle">Please be respectful in the comments.</p>
        <a href="admin.html" class="admin-link">Admin Login</a>
    </header>

    <main>
        <div id="rankings-container">
            <div class="loading">Loading rankings...</div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import firebaseConfig from './firebase-config.js';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function renderStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<span class="star-filled">‚òÖ</span>';
                } else if (i - 0.5 === rating) {
                    stars += '<span class="star-filled">¬Ω</span>';
                } else {
                    stars += '<span class="star-empty">‚òÜ</span>';
                }
            }
            return stars;
        }

        async function loadRankings() {
            const container = document.getElementById('rankings-container');
            
            try {
                const q = query(collection(db, 'rankings'), orderBy('displayOrder', 'asc'));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    container.innerHTML = '<div class="loading">No rankings yet. Check back soon!</div>';
                    return;
                }
                
                let html = '';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    html += `
                        <div class="ranking-item">
                            <div class="rank-number">#${data.displayOrder}</div>
                            <div class="ice-cream-info">
                                <div class="ice-cream-name">${data.name}</div>
                                <div class="ice-cream-location">${data.location}</div>
                            </div>
                            <div class="stars">${renderStars(data.rating)}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error("Error loading rankings:", error);
                container.innerHTML = '<div class="loading">Error loading rankings. Please try again later.</div>';
            }
        }

        // Load rankings when page loads
        loadRankings();
    </script>
</body>
</html>
